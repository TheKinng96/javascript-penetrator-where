<!DOCTYPE html>
<html>
<head>
  <title>Google Maps Property Overlay</title>
  <style>
    /* Basic CSS for the page */
    body, html {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }

    #map {
      height: 100%;
    }

    /* The Modal (background) */
    .modal {
      display: none; /* Hidden by default */
      position: fixed; /* Stay in place */
      z-index: 1000; /* Sit on top */
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto; /* Enable scroll if needed */
      background-color: rgba(0,0,0,0.6); /* Black w/ opacity */
      /* Use flexbox to center the modal content */
      align-items: center;
      justify-content: center;
    }

    /* Modal Content/Box */
    .modal-content {
      background-color: #fefefe;
      margin: auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
      max-width: 400px;
      border-radius: 8px;
      box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
      position: relative;
    }

    /* The Close Button */
    .close-button {
      color: #aaa;
      position: absolute;
      top: 10px;
      right: 20px;
      font-size: 28px;
      font-weight: bold;
    }

    .close-button:hover,
    .close-button:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <!-- The div where the map will be rendered -->
  <div id="map"></div>

  <!-- The Modal for property information -->
  <div id="info-modal" class="modal">
    <div class="modal-content">
      <span class="close-button">Ã—</span>
      <div id="modal-body">
        <!-- Property info will be injected here by JavaScript -->
      </div>
    </div>
  </div>

  <script>
    // --- DATA ---
    // In a real application, fetch this data from a server.
    const propertiesData = [
      {
        owner: 'The Smith Family',
        path: [
          { lat: 37.7749, lng: -122.4194 },
          { lat: 37.7755, lng: -122.4194 },
          { lat: 37.7755, lng: -122.4185 },
          { lat: 37.7749, lng: -122.4185 },
        ],
      },
      {
        owner: 'Jane Doe',
        path: [
          { lat: 37.7740, lng: -122.4180 },
          { lat: 37.7745, lng: -122.4180 },
          { lat: 37.7745, lng: -122.4170 },
          { lat: 37.7740, lng: -122.4170 },
        ],
      },
    ];

    // --- STYLES for polygons ---
    const defaultStyle = {
      strokeColor: '#FF0000',
      strokeOpacity: 0.8,
      strokeWeight: 2,
      fillColor: '#FF0000',
      fillOpacity: 0.35,
    };

    const highlightStyle = {
      strokeColor: '#0000FF',
      strokeOpacity: 1.0,
      strokeWeight: 4,
      fillColor: '#0000FF',
      fillOpacity: 0.5,
    };
    
    let map;
    // Keep track of the highlighted polygon
    let highlightedPolygon = null;

    function initMap() {
      // Initialize the map centered on San Francisco
      map = new google.maps.Map(document.getElementById('map'), {
        zoom: 16,
        center: { lat: 37.7749, lng: -122.4194 }, // Center on our first property
        mapTypeId: 'satellite'
      });

      // --- Draw Polygons and Add Listeners ---
      propertiesData.forEach(property => {
        const polygon = new google.maps.Polygon({
          paths: property.path,
          ...defaultStyle // Spread operator for default styles
        });

        polygon.propertyInfo = property;

        polygon.setMap(map);

        polygon.addListener('click', function() {
          if (highlightedPolygon) {
            highlightedPolygon.setOptions(defaultStyle);
          }
          
          this.setOptions(highlightStyle);
          highlightedPolygon = this; // Set the current polygon as highlighted

          showInfoModal(this.propertyInfo);
        });
      });

      // --- MODAL LOGIC ---
      const modal = document.getElementById('info-modal');
      const closeButton = document.querySelector('.close-button');

      function showInfoModal(info) {
        const modalBody = document.getElementById('modal-body');
        modalBody.innerHTML = `
          <h2>Property Details</h2>
          <p><strong>Owner:</strong> ${info.owner}</p>
        `;
        modal.style.display = 'flex';
      }
      
      function hideModal() {
        modal.style.display = 'none';
        if (highlightedPolygon) {
          highlightedPolygon.setOptions(defaultStyle);
          highlightedPolygon = null; // Clear the reference
        }
      }

      closeButton.onclick = function() {
        hideModal();
      }

      window.onclick = function(event) {
        if (event.target == modal) {
          hideModal();
        }
      }
    }
  </script>

  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCL4-QNF9PAPzxxDQJ5DRDOHuAEwNKP5mo&callback=initMap">
  </script>

</body>
</html>
